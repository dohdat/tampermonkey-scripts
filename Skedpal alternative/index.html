<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal SkedPal Scheduler</title>
    <link rel="stylesheet" href="tailwind.css" />
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100 font-body">
    <div class="fixed top-4 right-4 z-20">
      <button
        data-reschedule-btn
        class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow-lg shadow-lime-400/30 hover:bg-lime-300"
        type="button"
      >
        Reschedule
      </button>
    </div>
    <div
      class="min-h-screen bg-[radial-gradient(circle_at_10%_10%,rgba(34,197,94,0.08),transparent_32%),radial-gradient(circle_at_80%_0%,rgba(59,130,246,0.08),transparent_35%)] pb-10"
    >
      <header class="mx-auto w-full max-w-4xl px-6 pt-8 pb-4 space-y-4">
        <div>
          <h1 class="text-2xl font-semibold tracking-wide">Personal SkedPal</h1>
          <p class="text-sm text-slate-400">Manual SkedPal-style scheduler for Google Calendar.</p>
        </div>
        <div class="grid grid-cols-3 gap-3">
          <button
            data-view="tasks"
            class="nav-btn rounded-xl border border-lime-400/60 bg-slate-900/70 px-3 py-2 text-sm font-semibold text-slate-100 shadow ring-1 ring-lime-400/50"
          >
            Tasks
          </button>
          <button
            data-view="timemaps"
            class="nav-btn rounded-xl border border-slate-800 bg-slate-900/50 px-3 py-2 text-sm font-semibold text-slate-200 shadow"
          >
            TimeMaps
          </button>
          <button
            data-view="schedule"
            class="nav-btn rounded-xl border border-slate-800 bg-slate-900/50 px-3 py-2 text-sm font-semibold text-slate-200 shadow"
          >
            Schedule
          </button>
        </div>
      </header>
      <main class="mx-auto w-full max-w-4xl px-6 space-y-4 pb-8">
        <section id="tasks" class="view space-y-3">
          <div class="flex items-center justify-between gap-2">
            <div class="text-sm text-slate-300">Add tasks to schedule automatically.</div>
            <button
              id="task-toggle"
              class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-lime-300"
              type="button"
            >
              Add task
            </button>
          </div>
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex flex-wrap items-center gap-3">
              <h3 class="text-base font-semibold">Sections</h3>
              <div id="section-list" class="flex flex-wrap gap-2 text-xs"></div>
              <button
                id="section-form-toggle"
                type="button"
                class="rounded-xl border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-200 hover:border-lime-400"
              >
                Add section
              </button>
            </div>
            <div id="section-form-row" class="hidden flex flex-col gap-2 md:flex-row md:items-center">
              <input
                id="section-new-name"
                placeholder="Add new section"
                class="w-full rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2 text-slate-100 placeholder:text-slate-500 focus:border-lime-400 focus:outline-none"
              />
              <button
                id="section-add"
                type="button"
                class="rounded-xl border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 hover:border-lime-400"
              >
                Add section
              </button>
            </div>
      </div>
          <div
            id="zoom-banner"
            class="hidden rounded-xl border border-slate-800 bg-slate-900/70 px-4 py-3 text-sm text-slate-200"
          ></div>
          <div id="task-list" class="grid gap-3"></div>
        </section>

        <section id="timemaps" class="view hidden space-y-3">
          <div class="flex items-center justify-between gap-2">
            <div class="text-sm text-slate-300">Define availability maps; expand to add or edit.</div>
            <button
              id="timemap-toggle"
              class="rounded-lg border border-slate-700 px-3 py-2 text-sm font-semibold text-slate-200 hover:border-lime-400"
              type="button"
            >
              Show TimeMap form
            </button>
          </div>
          <div id="timemap-form-wrap" class="hidden">
            <form
              id="timemap-form"
              class="mt-2 grid gap-3 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg"
            >
              <input type="hidden" id="timemap-id" />
              <label class="grid gap-2 text-sm text-slate-300">
                Name
                <input
                  id="timemap-name"
                  required
                  placeholder="Deep Work"
                  class="w-full rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2 text-slate-100 placeholder:text-slate-500 focus:border-lime-400 focus:outline-none"
                />
              </label>
              <label class="grid gap-2 text-sm text-slate-300">
                Color (hex)
                <input
                  id="timemap-color"
                  type="color"
                  value="#22c55e"
                  class="h-11 w-24 rounded-xl border border-slate-800 bg-slate-900 px-2 py-1 text-slate-100"
                />
              </label>
              <label class="grid gap-2 text-sm text-slate-300">
                Per-day availability (each day can differ; add multiple blocks per day)
                <div id="timemap-day-rows" class="grid gap-2"></div>
              </label>
              <div class="flex justify-end gap-2">
                <button
                  class="rounded-xl border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 hover:border-lime-400"
                  type="button"
                  id="timemap-reset"
                >
                  Reset
                </button>
                <button
                  class="rounded-xl border border-lime-400/60 px-4 py-2 text-sm font-semibold text-lime-300 hover:border-lime-400"
                  type="button"
                  id="timemap-set-default"
                >
                  Set as default
                </button>
                <button
                  class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-lime-300"
                  type="submit"
                >
                  Save TimeMap
                </button>
              </div>
            </form>
          </div>
          <div id="timemap-list" class="grid gap-3"></div>
        </section>

        <section id="schedule" class="view hidden space-y-3">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex flex-col gap-3 md:flex-row md:items-start md:justify-between">
              <div>
                <h3 class="text-base font-semibold">Reschedule</h3>
                <p class="text-sm text-slate-400">
                  Deletes previous scheduled task events (source=personal-skedpal), fetches FreeBusy, and fills the
                  earliest valid slots.
                </p>
              </div>
              <button
                data-reschedule-btn
                class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-lime-300"
                type="button"
              >
                Reschedule Now
              </button>
            </div>
            <div class="grid gap-3 md:grid-cols-[200px_1fr]">
              <label class="grid gap-2 text-sm text-slate-300">
                Horizon (days)
                <input
                  id="horizon"
                  type="number"
                  min="1"
                  max="60"
                  class="w-full rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2 text-slate-100 focus:border-lime-400 focus:outline-none"
                />
              </label>
              <div class="text-sm text-slate-400" id="schedule-status">Idle</div>
            </div>
          </div>
          <div id="scheduled-summary" class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg"></div>
        </section>
      </main>
      <div id="task-form-wrap" class="task-modal hidden">
        <div class="task-modal__panel">
          <div class="task-modal__header">
            <div>
              <p class="task-modal__eyebrow">Task intake</p>
              <h3 class="task-modal__title">Plan a new task</h3>
              <p class="task-modal__subtitle">Set deadline, duration, and allowed TimeMaps before scheduling.</p>
            </div>
            <button type="button" class="task-modal__close" data-task-modal-close aria-label="Close task form">
              ×
            </button>
          </div>
          <form id="task-form" class="task-modal__form">
            <input type="hidden" id="task-id" />
            <div class="task-form-grid">
              <label class="field">
                <span class="field-label">Title</span>
                <input
                  id="task-title"
                  required
                  placeholder="Write a short task title"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Link (optional)</span>
                <input
                  id="task-link"
                  placeholder="https://example.com/details"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Duration (minutes)</span>
                <input
                  id="task-duration"
                  type="number"
                  min="15"
                  step="15"
                  value="30"
                  required
                  placeholder="30"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Priority (1 low – 5 high)</span>
                <select id="task-priority" class="field-input">
                  <option value="5">5</option>
                  <option value="4">4</option>
                  <option value="3" selected>3</option>
                  <option value="2">2</option>
                  <option value="1">1</option>
                </select>
              </label>
              <label class="field">
                <span class="field-label">Deadline</span>
                <input id="task-deadline" type="date" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Repeat</span>
                <select id="task-repeat" class="field-input">
                  <option value="none" selected>Does not repeat</option>
                  <option value="custom">Saved pattern</option>
                  <option value="custom-new">Custom...</option>
                </select>
              </label>
              <label class="field">
                <span class="field-label">Section</span>
                <select id="task-section" class="field-input"></select>
              </label>
              <label class="field">
                <span class="field-label">Subsection</span>
                <select id="task-subsection" class="field-input"></select>
              </label>
            </div>
            <div class="field">
              <span class="field-label">Allowed TimeMaps</span>
              <div id="task-timemap-options" class="timemap-pills"></div>
            </div>
            <div class="task-modal__actions">
              <button type="button" class="btn muted" data-task-modal-close>Cancel</button>
              <button type="submit" class="btn primary">Save Task</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div id="repeat-modal" class="task-modal hidden">
      <div class="task-modal__panel">
        <div class="task-modal__header">
          <div>
            <p class="task-modal__eyebrow">Repeat</p>
            <h3 class="task-modal__title">Custom recurrence</h3>
            <p class="task-modal__subtitle">Set up a repeating pattern similar to Google Calendar.</p>
          </div>
          <button type="button" class="task-modal__close" data-repeat-modal-close aria-label="Close repeat modal">
            x
          </button>
        </div>
        <div class="task-modal__form" id="task-repeat-custom">
          <div class="grid md:grid-cols-[140px_1fr] gap-3 items-center">
            <span class="field-label">Repeat every</span>
            <div class="flex items-center gap-3">
              <input
                id="task-repeat-interval"
                type="number"
                min="1"
                value="1"
                class="field-input"
                style="max-width: 110px"
              />
              <select id="task-repeat-unit" class="field-input" style="max-width: 150px">
                <option value="day">day</option>
                <option value="week">week</option>
                <option value="month">month</option>
                <option value="year">year</option>
              </select>
            </div>
          </div>
          <div class="mt-3 hidden" id="task-repeat-weekly-section">
            <span class="field-label">Repeat on</span>
            <div class="flex flex-wrap gap-2" id="task-repeat-weekdays"></div>
          </div>
          <div class="mt-3 hidden" id="task-repeat-monthly-section">
            <label class="field">
              <span class="field-label">Monthly options</span>
              <select id="task-repeat-monthly-mode" class="field-input">
                <option value="day">Monthly on day</option>
                <option value="nth">Monthly on the</option>
              </select>
            </label>
            <div class="grid md:grid-cols-2 gap-3 mt-2">
              <label class="field" id="task-repeat-monthly-day-wrap">
                <span class="field-label">Day of month</span>
                <input id="task-repeat-monthly-day" type="number" min="1" max="31" class="field-input" />
              </label>
              <div class="grid grid-cols-2 gap-2" id="task-repeat-monthly-nth-wrap">
                <label class="field">
                  <span class="field-label">Nth</span>
                  <select id="task-repeat-monthly-nth" class="field-input">
                    <option value="1">First</option>
                    <option value="2">Second</option>
                    <option value="3">Third</option>
                    <option value="4">Fourth</option>
                    <option value="-1">Last</option>
                  </select>
                </label>
                <label class="field">
                  <span class="field-label">Weekday</span>
                  <select id="task-repeat-monthly-weekday" class="field-input">
                    <option value="0">Sunday</option>
                    <option value="1">Monday</option>
                    <option value="2">Tuesday</option>
                    <option value="3">Wednesday</option>
                    <option value="4">Thursday</option>
                    <option value="5">Friday</option>
                    <option value="6">Saturday</option>
                  </select>
                </label>
              </div>
            </div>
          </div>
          <div class="mt-3 space-y-2">
            <span class="field-label">Ends</span>
            <label class="flex items-center gap-2 text-xs text-slate-200">
              <input type="radio" name="task-repeat-end" id="task-repeat-end-never" value="never" checked />
              <span>Never</span>
            </label>
            <label class="flex items-center gap-2 text-xs text-slate-200">
              <input type="radio" name="task-repeat-end" id="task-repeat-end-on" value="on" />
              <span>On</span>
              <input type="date" id="task-repeat-end-date" class="field-input" style="max-width: 180px" />
            </label>
            <label class="flex items-center gap-2 text-xs text-slate-200">
              <input type="radio" name="task-repeat-end" id="task-repeat-end-after" value="after" />
              <span>After</span>
              <input
                type="number"
                min="1"
                value="1"
                id="task-repeat-end-count"
                class="field-input"
                style="max-width: 120px"
              />
              <span>occurrence(s)</span>
            </label>
          </div>
          <div class="task-modal__actions">
            <button type="button" class="btn muted" data-repeat-modal-close>Cancel</button>
            <button type="button" class="btn primary" id="task-repeat-save">Save repeat</button>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="page.js"></script>
  </body>
</html>

