<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal SkedPal Scheduler</title>
    <link rel="stylesheet" href="../styles/tailwind.css" />
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100 font-body">
    <div class="fixed top-4 right-4 z-20 flex flex-col items-end gap-2">
      <button
        data-reschedule-btn
        class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow-lg shadow-lime-400/30 hover:bg-lime-300"
        type="button"
      >
        Reschedule
      </button>
    </div>
    <div class="app-shell min-h-screen bg-[radial-gradient(circle_at_10%_10%,rgba(34,197,94,0.08),transparent_32%),radial-gradient(circle_at_80%_0%,rgba(59,130,246,0.08),transparent_35%)]">
      <aside class="sidebar" aria-label="Primary navigation">
        <div class="sidebar-brand">
          <span class="sidebar-mark" aria-hidden="true">
            <svg viewBox="0 0 64 64" width="26" height="26" fill="none">
              <defs>
                <linearGradient id="sidebar-swoosh" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#22d3ee" />
                  <stop offset="100%" stop-color="#a855f7" />
                </linearGradient>
              </defs>
              <path
                d="M10 26c6-6.5 13.2-9.8 21.5-9.8 8.3 0 16 3.4 22.5 9.8-6 6.5-13.5 9.8-22.5 9.8C23.5 35.8 16 32.5 10 26Z"
                fill="url(#sidebar-swoosh)"
                opacity="0.85"
              />
              <path
                d="M17 38c5-4.8 10.7-7.3 17.5-7.3S47 33.2 53 38c-5.2 5.1-11.8 7.7-18.5 7.7S22.3 43.1 17 38Z"
                fill="url(#sidebar-swoosh)"
                opacity="0.7"
              />
            </svg>
          </span>
          <div>
            <p class="text-xs text-slate-400">SkedPal</p>
            <p class="text-sm font-semibold text-slate-100">Dashboard</p>
          </div>
        </div>
        <div class="sidebar-nav" role="navigation" aria-label="Main">
          <button class="nav-btn sidebar-link" data-view="tasks" type="button" aria-current="page">
            <span class="sidebar-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M5 6h14M5 12h14M5 18h14" stroke-linecap="round" />
                <circle cx="7" cy="6" r="1.25" fill="currentColor" />
                <circle cx="7" cy="12" r="1.25" fill="currentColor" />
                <circle cx="7" cy="18" r="1.25" fill="currentColor" />
              </svg>
            </span>
            <span class="sidebar-label">Tasks</span>
          </button>
          <div class="sidebar-favorites" data-fav-accordion>
            <button
              type="button"
              class="sidebar-fav-toggle"
              aria-expanded="false"
              aria-controls="sidebar-favorites"
              data-fav-toggle
              data-test-skedpal="favorites-toggle"
            >
              <span class="sidebar-icon" aria-hidden="true">
                <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 4h1.5L9 16m0 0h8m-8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm8 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm-8.5-3h9.25L19 7H7.312" />
                </svg>
              </span>
              <span class="sidebar-label">Favorites</span>
              <span class="sidebar-caret" aria-hidden="true">
                <svg class="caret-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7" />
                </svg>
              </span>
            </button>
            <ul
              id="sidebar-favorites"
              class="sidebar-fav-list hidden"
              aria-label="Favorite sections and subsections"
            ></ul>
          </div>
          <button class="nav-btn sidebar-link" data-view="today" type="button">
            <span class="sidebar-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M5 4h14M5 20h14M5 8h14M8 3v2M16 3v2" stroke-linecap="round" />
                <rect x="5" y="7" width="14" height="13" rx="2" ry="2" />
                <path d="M9.5 13.5 11 15l3.5-4" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </span>
            <span class="sidebar-label">Today</span>
          </button>
          <button class="nav-btn sidebar-link" data-view="calendar" type="button">
            <span class="sidebar-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
                <rect x="4" y="5" width="16" height="15" rx="2" ry="2" />
                <path d="M8 3v4M16 3v4M4 10h16" stroke-linecap="round" />
                <rect x="7" y="12.5" width="3" height="3" rx="0.6" />
                <rect x="12.5" y="12.5" width="3" height="3" rx="0.6" />
              </svg>
            </span>
            <span class="sidebar-label">Calendar</span>
          </button>
          <button class="nav-btn sidebar-link" data-view="settings" type="button">
            <span class="sidebar-icon" aria-hidden="true">
              <svg viewBox="0 0 20 20" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M8.5 2.5h3l.5 2.2a5.5 5.5 0 0 1 1.8 1.1l2.1-.8 1.5 2.6-1.6 1.4c.1.35.2.73.2 1.1s-.07.75-.2 1.1l1.6 1.4-1.5 2.6-2.1-.8a5.5 5.5 0 0 1-1.8 1.1l-.5 2.2h-3l-.5-2.2a5.5 5.5 0 0 1-1.8-1.1l-2.1.8-1.5-2.6 1.6-1.4a5 5 0 0 1-.2-1.1c0-.37.07-.75.2-1.1L2.6 7.6l1.5-2.6 2.1.8a5.5 5.5 0 0 1 1.8-1.1Z" stroke-linejoin="round"></path>
                <circle cx="10" cy="10" r="2.2"></circle>
              </svg>
            </span>
            <span class="sidebar-label">Settings</span>
          </button>
        </div>
      </aside>
      <div class="app-main flex-1 pb-10">
        <header class="mx-auto w-full max-w-4xl px-6 pt-8 pb-4 space-y-4">
          <div id="nav-breadcrumb" class="flex items-center gap-2 text-xs text-slate-400"></div>
          <div>
            <h1 class="text-2xl font-semibold tracking-wide">Personal SkedPal</h1>
          </div>
        </header>
        <main class="mx-auto w-full max-w-4xl px-6 space-y-4 pb-8">
        <div
          id="notification-banner"
          class="notification-banner hidden"
          role="status"
          aria-live="polite"
        >
          <span id="notification-message" class="notification-banner__message"></span>
          <button id="notification-undo" type="button" class="notification-banner__undo">Undo</button>
        </div>
        <section id="tasks" class="view space-y-3">
          <div class="flex items-center justify-between gap-2">
            <div class="text-sm text-slate-300">Add tasks to schedule automatically.</div>
            <button
              id="task-toggle"
              class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-lime-300"
              type="button"
              data-test-skedpal="task-toggle"
            >
              Add task
            </button>
          </div>
          <div id="task-list" class="grid gap-3" data-test-skedpal="task-list"></div>
        </section>

        <section id="today" class="view hidden space-y-3">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex items-center justify-between gap-2">
              <h3 class="text-base font-semibold">Today</h3>
              <span class="text-xs text-slate-400">Day snapshot</span>
            </div>
            <p class="text-sm text-slate-400">
              Quick day overview goes here. Use Tasks to add and prioritize items, then come back for a focused view of
              your current day.
            </p>
          </div>
        </section>

        <section id="calendar" class="view hidden space-y-3">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex items-center justify-between gap-2">
              <h3 class="text-base font-semibold">Calendar</h3>
              <span class="text-xs text-slate-400">Schedule preview</span>
            </div>
            <p class="text-sm text-slate-400">
              Calendar details will live here. For now, manage scheduling from Tasks and Settings while this view is
              wired up.
            </p>
          </div>
        </section>

        <section id="settings" class="view hidden space-y-4">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex flex-wrap items-center gap-3">
              <h3 class="text-base font-semibold">Sections</h3>
              <div id="section-list" class="flex flex-wrap gap-2 text-xs" data-test-skedpal="section-list"></div>
              <button
                id="section-form-toggle"
                type="button"
                class="rounded-xl border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-200 hover:border-lime-400"
                data-test-skedpal="section-form-toggle"
              >
                Add section
              </button>
            </div>
            <div id="section-form-row" class="hidden flex flex-col gap-2 md:flex-row md:items-center" data-test-skedpal="section-form-row">
              <input
                id="section-new-name"
                placeholder="Add new section"
                class="w-full rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2 text-slate-100 placeholder:text-slate-500 focus:border-lime-400 focus:outline-none"
                data-test-skedpal="section-new-name"
              />
              <button
                id="section-add"
                type="button"
                class="rounded-xl border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 hover:border-lime-400"
                data-test-skedpal="section-add"
              >
                Add section
              </button>
            </div>
          </div>
          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs uppercase tracking-wide text-slate-500">TimeMaps</p>
                <h3 class="text-base font-semibold">Availability maps</h3>
                <p class="text-sm text-slate-400">Create and edit TimeMaps to control when tasks can be scheduled.</p>
              </div>
              <button
                id="timemap-toggle"
                class="rounded-lg border border-slate-700 px-3 py-2 text-sm font-semibold text-slate-200 hover:border-lime-400"
                type="button"
                data-test-skedpal="timemap-toggle"
              >
                Show TimeMap form
              </button>
            </div>
            <div id="timemap-form-wrap" class="hidden">
              <form
                id="timemap-form"
                class="mt-2 grid gap-3 rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg"
                data-test-skedpal="timemap-form"
              >
                <input type="hidden" id="timemap-id" />
                <label class="grid gap-2 text-sm text-slate-300">
                  Name
                  <input
                    id="timemap-name"
                    required
                    placeholder="Deep Work"
                    class="w-full rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2 text-slate-100 placeholder:text-slate-500 focus:border-lime-400 focus:outline-none"
                  />
                </label>
                <label class="grid gap-2 text-sm text-slate-300">
                  Color (hex)
                  <input
                    id="timemap-color"
                    type="color"
                    value="#22c55e"
                    class="h-11 w-24 rounded-xl border border-slate-800 bg-slate-900 px-2 py-1 text-slate-100"
                  />
                </label>
                <label class="grid gap-2 text-sm text-slate-300">
                  Per-day availability (each day can differ; add multiple blocks per day)
                  <div id="timemap-day-rows" class="grid gap-2"></div>
                </label>
                <div class="flex justify-end gap-2">
                  <button
                    class="rounded-xl border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 hover:border-lime-400"
                    type="button"
                    id="timemap-reset"
                  >
                    Reset
                  </button>
                  <button
                    class="rounded-xl border border-lime-400/60 px-4 py-2 text-sm font-semibold text-lime-300 hover:border-lime-400"
                    type="button"
                    id="timemap-set-default"
                  >
                    Set as default
                  </button>
                  <button
                    class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-lime-300"
                    type="submit"
                  >
                    Save TimeMap
                  </button>
                </div>
              </form>
            </div>
            <div id="timemap-list" class="grid gap-3"></div>
          </div>

          <div class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg space-y-3">
            <div class="flex flex-col gap-3 md:flex-row md:items-start md:justify-between">
              <div>
                <p class="text-xs uppercase tracking-wide text-slate-500">Schedule</p>
                <h3 class="text-base font-semibold">Reschedule</h3>
                <p class="text-sm text-slate-400">
                  Deletes previous scheduled task events (source=personal-skedpal), fetches FreeBusy, and fills the
                  earliest valid slots.
                </p>
              </div>
              <button
                data-reschedule-btn
                class="rounded-xl bg-lime-400 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-lime-300"
                type="button"
              >
                Reschedule Now
              </button>
            </div>
            <div class="grid gap-3 md:grid-cols-[200px_1fr]">
              <label class="grid gap-2 text-sm text-slate-300">
                Horizon (days)
                <input
                  id="horizon"
                  type="number"
                  min="1"
                  max="60"
                  class="w-full rounded-xl border border-slate-800 bg-slate-950/80 px-3 py-2 text-slate-100 focus:border-lime-400 focus:outline-none"
                />
              </label>
              <div class="text-sm text-slate-400" id="schedule-status">Idle</div>
            </div>
          </div>
          <div id="scheduled-summary" class="rounded-2xl border border-slate-800 bg-slate-900/70 p-4 shadow-lg"></div>
        </section>
      </main>
      </div>
    </div>
      <div id="task-form-wrap" class="task-modal hidden">
        <div class="task-modal__panel">
          <div class="task-modal__header">
            <div>
              <p class="task-modal__eyebrow">Task intake</p>
              <h3 class="task-modal__title">Plan a new task</h3>
              <p class="task-modal__subtitle">Set deadline, duration, and allowed TimeMaps before scheduling.</p>
            </div>
            <button type="button" class="task-modal__close" data-task-modal-close aria-label="Close task form">
              ×
            </button>
          </div>
          <form id="task-form" class="task-modal__form">
            <input type="hidden" id="task-id" />
            <input type="hidden" id="task-parent-id" />
            <div class="task-form-grid">
              <label class="field">
                <span class="field-label">Title</span>
                <input
                  id="task-title"
                  required
                  placeholder="Write a short task title"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Link (optional)</span>
                <input
                  id="task-link"
                  placeholder="https://example.com/details"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Duration (minutes)</span>
                <input
                  id="task-duration"
                  type="number"
                  min="15"
                  step="15"
                  value="30"
                  required
                  placeholder="30"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Min block length (minutes)</span>
                <input
                  id="task-min-block"
                  type="number"
                  min="15"
                  step="15"
                  value="30"
                  placeholder="30"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Priority (1 low – 5 high)</span>
                <select id="task-priority" class="field-input">
                  <option value="5">5</option>
                  <option value="4">4</option>
                  <option value="3" selected>3</option>
                  <option value="2">2</option>
                  <option value="1">1</option>
                </select>
              </label>
              <label class="field">
                <span class="field-label">Deadline</span>
                <input id="task-deadline" type="date" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Start from</span>
                <input id="task-start-from" type="date" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Repeat</span>
                <select id="task-repeat" class="field-input">
                  <option value="none" selected>Does not repeat</option>
                  <option value="custom">Saved pattern</option>
                  <option value="custom-new">Custom...</option>
                </select>
              </label>
              <label class="field">
                <span class="field-label">Section</span>
                <select id="task-section" class="field-input"></select>
              </label>
              <label class="field">
                <span class="field-label">Subsection</span>
                <select id="task-subsection" class="field-input"></select>
              </label>
            </div>
            <div class="field">
              <span class="field-label">Allowed TimeMaps</span>
              <div id="task-timemap-options" class="timemap-pills"></div>
            </div>
            <div class="task-modal__actions">
              <button type="button" class="btn muted" data-task-modal-close>Cancel</button>
              <button type="submit" class="btn primary">Save Task</button>
            </div>
          </form>
        </div>
      </div>
      <div id="subsection-form-wrap" class="task-modal hidden">
        <div class="task-modal__panel">
          <div class="task-modal__header">
            <div>
              <p class="task-modal__eyebrow">Subsection</p>
              <h3 class="task-modal__title">Add subsection</h3>
              <p class="task-modal__subtitle">Define a subsection and default task settings it should inherit.</p>
            </div>
            <button type="button" class="task-modal__close" data-subsection-modal-close aria-label="Close subsection form">
              x
            </button>
          </div>
          <form id="subsection-form" class="task-modal__form">
            <input type="hidden" id="subsection-section-id" />
            <input type="hidden" id="subsection-parent-id" />
            <div class="task-form-grid">
              <label class="field">
                <span class="field-label">Subsection name</span>
                <input id="subsection-name" required placeholder="Planning, Backlog, etc." class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Default task title</span>
                <input id="subsection-task-title" placeholder="Optional default title" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Default link</span>
                <input id="subsection-task-link" placeholder="https://example.com" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Default duration (minutes)</span>
                <input
                  id="subsection-task-duration"
                  type="number"
                  min="15"
                  step="15"
                  value="30"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Default min block length (minutes)</span>
                <input
                  id="subsection-task-min-block"
                  type="number"
                  min="15"
                  step="15"
                  value="30"
                  class="field-input"
                />
              </label>
              <label class="field">
                <span class="field-label">Default priority</span>
                <select id="subsection-task-priority" class="field-input">
                  <option value="5">5</option>
                  <option value="4">4</option>
                  <option value="3" selected>3</option>
                  <option value="2">2</option>
                  <option value="1">1</option>
                </select>
              </label>
              <label class="field">
                <span class="field-label">Default deadline</span>
                <input id="subsection-task-deadline" type="date" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Default start from</span>
                <input id="subsection-task-start-from" type="date" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Default repeat</span>
                <select id="subsection-task-repeat" class="field-input">
                  <option value="none" selected>Does not repeat</option>
                  <option value="custom">Saved pattern</option>
                  <option value="custom-new">Custom...</option>
                </select>
              </label>
            </div>
            <div class="field">
              <span class="field-label">Allowed TimeMaps</span>
              <div id="subsection-timemap-options" class="timemap-pills"></div>
            </div>
            <div class="task-modal__actions">
              <button type="button" class="btn muted" data-subsection-modal-close>Cancel</button>
              <button type="submit" class="btn primary">Save Subsection</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div id="repeat-modal" class="task-modal hidden">
      <div class="task-modal__panel">
        <div class="task-modal__header">
          <div>
            <p class="task-modal__eyebrow">Repeat</p>
            <h3 class="task-modal__title">Custom recurrence</h3>
            <p class="task-modal__subtitle">Set up a repeating pattern similar to Google Calendar.</p>
          </div>
          <button type="button" class="task-modal__close" data-repeat-modal-close aria-label="Close repeat modal">
            x
          </button>
        </div>
        <div class="task-modal__form" id="task-repeat-custom">
          <div class="grid md:grid-cols-[140px_1fr] gap-3 items-center">
            <span class="field-label">Repeat every</span>
            <div class="flex items-center gap-3">
              <input
                id="task-repeat-interval"
                type="number"
                min="1"
                value="1"
                class="field-input"
                style="max-width: 110px"
              />
              <select id="task-repeat-unit" class="field-input" style="max-width: 150px">
                <option value="day">day</option>
                <option value="week">week</option>
                <option value="month">month</option>
                <option value="year">year</option>
              </select>
            </div>
          </div>
          <div class="mt-3 hidden" id="task-repeat-weekly-section">
            <span class="field-label">Repeat on</span>
            <div class="flex flex-wrap gap-2" id="task-repeat-weekdays"></div>
          </div>
          <div class="mt-3 hidden" id="task-repeat-monthly-section">
            <label class="field">
              <span class="field-label">Monthly options</span>
              <select id="task-repeat-monthly-mode" class="field-input">
                <option value="day">Monthly on day</option>
                <option value="nth">Monthly on the</option>
              </select>
            </label>
            <div class="grid md:grid-cols-2 gap-3 mt-2">
              <label class="field" id="task-repeat-monthly-day-wrap">
                <span class="field-label">Day of month</span>
                <input id="task-repeat-monthly-day" type="number" min="1" max="31" class="field-input" />
              </label>
              <div class="grid grid-cols-2 gap-2" id="task-repeat-monthly-nth-wrap">
                <label class="field">
                  <span class="field-label">Nth</span>
                  <select id="task-repeat-monthly-nth" class="field-input">
                    <option value="1">First</option>
                    <option value="2">Second</option>
                    <option value="3">Third</option>
                    <option value="4">Fourth</option>
                    <option value="-1">Last</option>
                  </select>
                </label>
                <label class="field">
                  <span class="field-label">Weekday</span>
                  <select id="task-repeat-monthly-weekday" class="field-input">
                    <option value="0">Sunday</option>
                    <option value="1">Monday</option>
                    <option value="2">Tuesday</option>
                    <option value="3">Wednesday</option>
                    <option value="4">Thursday</option>
                    <option value="5">Friday</option>
                    <option value="6">Saturday</option>
                  </select>
                </label>
              </div>
            </div>
          </div>
          <div class="mt-3 space-y-2">
            <span class="field-label">Ends</span>
            <label class="flex items-center gap-2 text-xs text-slate-200">
              <input type="radio" name="task-repeat-end" id="task-repeat-end-never" value="never" checked />
              <span>Never</span>
            </label>
            <label class="flex items-center gap-2 text-xs text-slate-200">
              <input type="radio" name="task-repeat-end" id="task-repeat-end-on" value="on" />
              <span>On</span>
              <input type="date" id="task-repeat-end-date" class="field-input" style="max-width: 180px" />
            </label>
            <label class="flex items-center gap-2 text-xs text-slate-200">
              <input type="radio" name="task-repeat-end" id="task-repeat-end-after" value="after" />
              <span>After</span>
              <input
                type="number"
                min="1"
                value="1"
                id="task-repeat-end-count"
                class="field-input"
                style="max-width: 120px"
              />
              <span>occurrence(s)</span>
            </label>
          </div>
          <div class="task-modal__actions">
            <button type="button" class="btn muted" data-repeat-modal-close>Cancel</button>
            <button type="button" class="btn primary" id="task-repeat-save">Save repeat</button>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="../src/ui/page.js"></script>
  </body>
</html>

